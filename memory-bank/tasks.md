# Задачи проекта

## Активные задачи

### Задача: Разработка чат-приложения для владельцев общих приватных репозиториев GitHub

#### Описание
Создание веб-приложения для обмена текстовыми сообщениями между пользователями GitHub, у которых есть хотя бы один общий приватный репозиторий. Поддержка личных и групповых чатов, формируемых автоматически на основе состава приватных репозиториев.

#### Анализ сложности
- **Тип задачи**: Создание новой системы
- **Охват**: Множественные подсистемы (аутентификация, чаты, сообщения, интеграция с GitHub)
- **Время**: Недели до месяцев
- **Риск**: Высокий, архитектурный
- **Зависимости**: GitHub API, Rails, Hotwire, PostgreSQL

#### Уровень сложности
**Уровень 4: Комплексная система** - требует детального планирования, проектирования архитектуры и поэтапной реализации.

#### Обоснование уровня сложности
1. Проект требует создания полноценной системы с множеством взаимосвязанных компонентов
2. Необходима интеграция с внешним API (GitHub)
3. Требуется реализация сложной бизнес-логики (автоматическое создание чатов на основе репозиториев)
4. Необходимо обеспечить безопасность и производительность системы
5. Требуется разработка адаптивного интерфейса с поддержкой темной темы и многоязычности

#### План реализации (обновлен по результатам QA)

##### 1. Архитектура приложения
- **Модель данных**:
  - Пользователи (users): информация о пользователях GitHub
  - Репозитории (repositories): информация о приватных репозиториях
  - Связь пользователей и репозиториев (user_repositories): для определения общих репозиториев
  - Чаты (chats): личные и групповые чаты, с дополнительным полем title и last_message_at
  - Связь пользователей и чатов (chat_users): для отслеживания участников и выхода из чатов
  - Сообщения (messages): текстовые сообщения в чатах
  - Непрочитанные сообщения (unread_messages): для отслеживания статуса прочтения

- **Компоненты системы**:
  - Аутентификация через GitHub OAuth
  - Синхронизация данных с GitHub API
  - Система чатов и сообщений
  - Система статусов онлайн/офлайн через Action Cable
  - Интерфейс с поддержкой темной темы и многоязычности

- **Дополнительные архитектурные паттерны**:
  - Presenters для представления данных в UI
  - Query Objects для сложных запросов к базе данных
  - Form Objects для валидации форм
  - Policy Objects для авторизации
  - Service Objects для бизнес-логики

##### 2. Поэтапная реализация
- **Этап 1: Настройка базового проекта**
  - Настройка Rails приложения с PostgreSQL
  - Настройка Tailwind CSS и Hotwire (Turbo, Stimulus)
  - Настройка OmniAuth для GitHub
  - Настройка Redis для Action Cable и Sidekiq
  - Создание базовых моделей и миграций с оптимизированными индексами

- **Этап 2: Аутентификация и интеграция с GitHub**
  - Реализация входа через GitHub OAuth
  - Настройка Octokit для работы с GitHub API
  - Реализация кэширования данных GitHub API
  - Получение данных пользователя и его репозиториев
  - Сохранение данных в базе
  - Определение общих репозиториев между пользователями

- **Этап 3: Разработка системы чатов**
  - Автоматическое создание чатов на основе общих репозиториев
  - Реализация личных чатов
  - Реализация выхода из групповых чатов
  - Отображение участников чата
  - Настройка Action Cable для обновления списка чатов

- **Этап 4: Система сообщений**
  - Отправка и получение сообщений через Turbo Streams
  - Бесконечная прокрутка истории с оптимизированной загрузкой
  - Индикаторы непрочитанных сообщений
  - Отметка о прочтении сообщений
  - Фоновая обработка сообщений через Sidekiq

- **Этап 5: Интерфейс и UX**
  - Адаптивная верстка (Mobile First)
  - Реализация темной темы с CSS переменными
  - Локализация (RU/EN) через I18n
  - Статусы онлайн/офлайн через Action Cable
  - Оптимизация UI для мобильных устройств

- **Этап 6: Тестирование и оптимизация**
  - Написание тестов для моделей, контроллеров, интеграционные
  - Тесты для проверки лимитов GitHub API
  - Тесты производительности при большом количестве сообщений
  - Тесты безопасности (XSS, CSRF)
  - Оптимизация запросов к БД
  - Настройка кэширования
  - Рефакторинг кода

##### 3. Технические решения (обновлены)

- **Аутентификация**:
  - OmniAuth GitHub для аутентификации
  - Omniauth Rails CSRF Protection для безопасности
  - Сессионное хранение данных пользователя
  - Проверка прав доступа к приватным репозиториям

- **Интеграция с GitHub API**:
  - Использование Octokit для работы с GitHub API
  - Redis для кэширования ответов API
  - Conditional requests с ETag для экономии лимитов
  - Фоновая синхронизация данных через Sidekiq
  - Обработка ошибок API и повторные попытки

- **Реализация чатов**:
  - Hotwire (Turbo, Stimulus) для динамического обновления чатов
  - Action Cable для реализации статусов онлайн/офлайн
  - Оптимизированные запросы с eager loading для загрузки истории сообщений
  - Пагинация с бесконечной прокруткой для истории сообщений

- **Интерфейс**:
  - Tailwind CSS для адаптивной верстки
  - CSS переменные для темной темы
  - I18n для локализации
  - Stimulus контроллеры для интерактивных элементов

##### 4. Потенциальные проблемы и решения (обновлены)

- **Производительность при большом количестве сообщений**:
  - Пагинация и бесконечная прокрутка с оптимизированной загрузкой
  - Оптимизированные индексы в базе данных
  - Кэширование запросов через Redis
  - Партиционирование таблицы messages для чатов с большим количеством сообщений

- **Ограничения GitHub API**:
  - Обработка лимитов запросов с очередью и повторными попытками
  - Conditional requests с ETag для экономии лимитов
  - Фоновая синхронизация данных в периоды низкой нагрузки
  - Кэширование результатов запросов с TTL

- **Безопасность**:
  - Policy Objects для проверки прав доступа к чатам
  - Защита от XSS через Rails sanitization и CSP
  - Защита от CSRF через Rails CSRF protection
  - Валидация входных данных через Form Objects

#### Контрольный список
- [x] **Планирование и анализ**
  - [x] Анализ требований из спецификации
  - [x] Определение архитектуры приложения
  - [x] Планирование структуры базы данных
  - [x] Определение интеграции с GitHub API
  - [x] Техническая валидация (QA)

- [ ] **Настройка проекта**
  - [ ] Настройка Rails приложения
  - [ ] Настройка PostgreSQL
  - [ ] Настройка Redis
  - [ ] Настройка Tailwind CSS
  - [ ] Настройка Hotwire (Turbo, Stimulus)
  - [ ] Настройка OmniAuth для GitHub
  - [ ] Настройка Sidekiq

- [ ] **Разработка моделей и миграций**
  - [ ] Модель User
  - [ ] Модель Repository
  - [ ] Модель UserRepository
  - [ ] Модель Chat
  - [ ] Модель ChatUser
  - [ ] Модель Message
  - [ ] Модель UnreadMessage
  - [ ] Оптимизированные индексы

- [ ] **Аутентификация**
  - [ ] Интеграция с GitHub OAuth
  - [ ] Настройка прав доступа к приватным репозиториям
  - [ ] Создание контроллера аутентификации
  - [ ] Обработка callback от GitHub
  - [ ] Защита от CSRF

- [ ] **Интеграция с GitHub API**
  - [ ] Настройка Octokit
  - [ ] Получение данных пользователя
  - [ ] Получение списка приватных репозиториев
  - [ ] Кэширование ответов API
  - [ ] Обработка ошибок и лимитов API

- [ ] **Разработка чатов**
  - [ ] Создание личных чатов
  - [ ] Создание групповых чатов на основе репозиториев
  - [ ] Реализация выхода из группового чата
  - [ ] Отображение участников чата
  - [ ] Настройка Action Cable для обновлений

- [ ] **Разработка системы сообщений**
  - [ ] Отправка сообщений
  - [ ] Получение истории сообщений с бесконечной прокруткой
  - [ ] Отметка о прочтении сообщений
  - [ ] Индикаторы непрочитанных сообщений
  - [ ] Фоновая обработка сообщений

- [ ] **Разработка профилей пользователей**
  - [ ] Страница профиля с информацией о пользователе
  - [ ] Отображение статистики (репозитории, звезды)
  - [ ] Переход на профиль из чата

- [ ] **Разработка интерфейса**
  - [ ] Адаптивная верстка (Mobile First)
  - [ ] Реализация темной темы
  - [ ] Локализация (RU/EN)
  - [ ] Модальное окно для подтверждения выхода из чата
  - [ ] Stimulus контроллеры для интерактивных элементов

- [ ] **Статус онлайн/офлайн**
  - [ ] Отслеживание статуса пользователя через Action Cable
  - [ ] Отображение статуса в списке чатов и участников
  - [ ] Оптимизация для большого количества пользователей

- [ ] **Тестирование**
  - [ ] Написание тестов для моделей
  - [ ] Написание тестов для контроллеров
  - [ ] Написание интеграционных тестов
  - [ ] Тестирование безопасности (XSS, CSRF)
  - [ ] Тестирование лимитов GitHub API
  - [ ] Тестирование производительности

- [ ] **Оптимизация и рефакторинг**
  - [ ] Оптимизация запросов к БД
  - [ ] Настройка кэширования через Redis
  - [ ] Оптимизация Action Cable
  - [ ] Рефакторинг кода с использованием дополнительных паттернов

- [ ] **Документация**
  - [ ] Документация по API
  - [ ] Инструкция по развертыванию
  - [ ] Руководство пользователя

## Завершенные задачи
- [x] Инициализация Memory Bank
- [x] Определение уровня сложности проекта
- [x] Создание детального плана реализации
- [x] Создание диаграмм системы
- [x] Техническая валидация (QA)
